<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin ‚Äî DarkVoice</title>

<!-- Futuristic Font -->
<link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

<link rel="icon" href="assets/favicon-32.png" sizes="32x32">
<link rel="icon" href="assets/favicon-64.png" sizes="64x64">
<link rel="shortcut icon" href="d/favicon.ico" type="image/x-icon">
 

<style>
  :root{
    --bg:#f5f6f7;
    --text:#222;
    --card:#ffffffcc;
    --accent:#00aaff;
    --muted: rgba(0,0,0,0.6);
  }
  body.dark{
    --bg:#05060a;
    --text:#eaeaea;
    --card: rgba(20,24,35,0.75);
    --accent:#00d0ff;
    --muted: rgba(255,255,255,0.75);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:'Oxanium',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:var(--bg);color:var(--text);transition:background .25s,color .25s}

  .site{max-width:1100px;margin:20px auto;padding:16px}

  header{
    display:flex;align-items:center;justify-content:space-between;
    gap:12px;padding:14px 18px;border-radius:14px;
    background:var(--card);backdrop-filter:blur(8px);
    border:1px solid rgba(0,0,0,0.06);
    box-shadow:0 6px 22px rgba(0,0,0,0.06);
  }
  body.dark header{border-color:rgba(255,255,255,0.06)}
  .brand{display:flex;gap:14px;align-items:center}
  .brand img{width:56px;height:56px;border-radius:10px;object-fit:cover;filter:drop-shadow(0 0 8px #6fd7ff33)}
  .brand h1{font-size:20px;margin:0}
  .brand .small{font-size:13px;opacity:.8;margin-top:2px}

  nav{display:flex;gap:12px;align-items:center}
  nav a{color:var(--text);text-decoration:none;padding:8px 12px;border-radius:10px;font-size:15px;transition:.15s}
  nav a:hover{background:rgba(0,0,0,0.04);color:var(--accent)}

  /* theme button */
  #themeToggle{
    padding:8px 12px;border-radius:10px;border:none;cursor:pointer;background:var(--accent);color:#000;font-weight:700;
    box-shadow:0 6px 18px rgba(0,167,255,0.12);
  }
  body.dark #themeToggle{background:#0e1320;color:#fff;box-shadow:0 6px 18px rgba(0,167,255,0.22)}
  
  main{margin-top:20px}
  .card{
    background:var(--card);border-radius:14px;padding:20px;border:1px solid rgba(0,0,0,0.06);
    box-shadow:0 10px 30px rgba(0,0,0,0.06);backdrop-filter:blur(6px);
  }
  body.dark .card{border-color:rgba(255,255,255,0.06)}

  h2{margin:0 0 8px 0;font-size:24px}
  .small{font-size:14px;color:var(--muted);margin-bottom:12px;display:block}

  /* buttons and links */
  .btn{
    display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:#000;text-decoration:none;border:none;cursor:pointer;font-weight:700;
    box-shadow:0 8px 26px rgba(0,167,255,0.1);
  }
  .link{
    display:inline-block;padding:10px 14px;border-radius:10px;background:transparent;color:var(--text);border:1px solid transparent;cursor:pointer;text-decoration:none;
  }
  .link:hover{background:rgba(0,0,0,0.04)}

  /* admin area specifics */
  #controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  #adminArea{margin-top:12px;display:none}

  .user-row{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);margin-top:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
  .user-row .meta{display:flex;flex-direction:column}
  .user-row strong{font-size:16px}
  .user-row .small{margin:0}

  select, input[type="text"], input[type="password"]{
    padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:transparent;color:var(--text)
  }

  details{margin-top:10px}
  details summary{cursor:pointer;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)}

  /* modal */
  .modal{
    position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,0.35);z-index:1000;
  }
  .modal .box{max-width:560px;width:100%}
  form input{width:100%;margin-top:8px}

  footer{margin-top:18px;text-align:center;color:var(--muted)}
  .muted{color:var(--muted)}
  @media (max-width:640px){
    header{flex-direction:column;gap:12px}
    nav{flex-wrap:wrap;justify-content:center}
  }
</style>
</head>
<body>
<div class="site">

<header>
  <div class="brand">
    <img src="assets/DK.png" alt="DarkVoice logo">
    <div>
      <h1>DarkVoice</h1>
      <div class="small">The best voice chat on Roblox</div>
    </div>
  </div>

  <nav>
    <a class="link" href="index.html">üõñ Home</a>
    <a class="link" href="shop.html">üõí Shop</a>
    <a class="link" href="blog.html">üì∞ Blog</a>
    <a class="link" href="stats.html">üìÉ Statistics</a>
    <a class="link" href="about.html">üìö About</a>
    <a class="link" href="servers.html">üñ•Ô∏è Servers</a>
    <a class="link" href="adminteam.html">üë• Admin Team</a>
    <a class="link" href="admin.html">‚öôÔ∏è Admin</a>
  </nav>

  <button id="themeToggle" title="Toggle theme">üåô Dark</button>
</header>

<main>

<section class="card">
  <h2>Admin Panel</h2>
  <span class="small">Client-side login simulation using localStorage. Default account: <strong>Sqm0</strong> / <em>darkvoice-owner</em></span>

  <div id="controls">
    <button class="btn" id="btnLogin">Sign in</button>
    <button class="link" id="btnRegister">Register</button>
    <button class="link" id="btnOpenAdmin">Open admin area</button>
  </div>

  <div id="adminArea" class="card"></div>
</section>

<!-- modal container -->
<div class="modal" id="modal" aria-hidden="true"></div>

</main>

<footer class="footer"><small>¬© <span data-year></span> DarkVoice ‚Äî All rights reserved</small></footer>
</div>

<script>
(async function(){
  /* Roles (same as original) */
  const roles = ['Owner','Developer','Manager','Community Manager','Head of Staff','Staff Supervisor','Administrator','Head Moderator','Moderator','Trial Moderator','Head Eventer','Eventer','Tester','Content Creator'];

  /* Helpers */
  const byId = id => document.getElementById(id);
  const USERS_KEY = 'darkvoice_users';
  const SESSION_KEY = 'darkvoice_session';

  function getUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY) || 'null') } catch(e){ return null } }
  function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)) }
  function getSession(){ try { return JSON.parse(sessionStorage.getItem(SESSION_KEY) || 'null') } catch(e){ return null } }
  function setSession(s){ sessionStorage.setItem(SESSION_KEY, JSON.stringify(s)) }

  async function hashPassword(p){ const enc = new TextEncoder().encode(p); const h = await crypto.subtle.digest('SHA-256', enc); return Array.from(new Uint8Array(h)).map(b => b.toString(16).padStart(2,'0')).join('') }

  /* Create default user if none */
  if(!getUsers()){
    const defaultHash = await hashPassword('darkvoice-owner'); // default password
    saveUsers([{ id: 1, username: 'Sqm0', password: defaultHash, rank: 'Owner', created: new Date().toISOString() }]);
  }

  /* Modal management */
  const modal = byId('modal');
  function openModal(html){
    modal.innerHTML = `<div class="box card">${html}</div>`;
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
  }
  function closeModal(){
    modal.style.display = 'none';
    modal.innerHTML = '';
    modal.setAttribute('aria-hidden','true');
  }
  modal.addEventListener('click', (e) => { if(e.target === modal) closeModal() });

  /* UI elements */
  const btnLogin = byId('btnLogin');
  const btnRegister = byId('btnRegister');
  const btnOpenAdmin = byId('btnOpenAdmin');
  const adminArea = byId('adminArea');

  /* Login flow */
  btnLogin.addEventListener('click', () => {
    openModal(`
      <h3>Sign in</h3>
      <form id="loginForm">
        <input name="username" placeholder="Username" required />
        <input type="password" name="password" placeholder="Password" required />
        <div style="display:flex;gap:8px;margin-top:10px;">
          <button class="btn" type="submit">Sign in</button>
          <button class="link" type="button" id="toReg">Register</button>
        </div>
        <div class="small" id="msg"></div>
      </form>
    `);

    document.getElementById('toReg').addEventListener('click', () => {
      closeModal();
      btnRegister.click();
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      const username = (fd.get('username') || '').trim();
      const password = fd.get('password') || '';
      const users = getUsers() || [];
      const found = users.find(x => x.username.toLowerCase() === username.toLowerCase());
      const msg = document.getElementById('msg');
      if(!found){ msg.textContent = 'User not found'; return }
      const hh = await hashPassword(password);
      if(hh === found.password){
        setSession({ id: found.id, username: found.username, rank: found.rank });
        msg.textContent = 'Signed in';
        renderAdmin();
        setTimeout(closeModal, 700);
      } else {
        msg.textContent = 'Wrong password';
      }
    });
  });

  /* Register flow */
  btnRegister.addEventListener('click', () => {
    openModal(`
      <h3>Register</h3>
      <form id="regForm">
        <input name="username" placeholder="Username" required />
        <input type="password" name="password" placeholder="Password" required />
        <input type="password" name="password2" placeholder="Password again" required />
        <div style="display:flex;gap:8px;margin-top:10px;">
          <button class="btn" type="submit">Register</button>
          <button class="link" type="button" id="toLogin">Sign in</button>
        </div>
        <div class="small" id="rmsg"></div>
      </form>
    `);

    document.getElementById('toLogin').addEventListener('click', () => {
      closeModal();
      btnLogin.click();
    });

    document.getElementById('regForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      const username = (fd.get('username') || '').trim();
      const password = fd.get('password') || '';
      const password2 = fd.get('password2') || '';
      const rmsg = document.getElementById('rmsg');

      if(password.length < 6){ rmsg.textContent = 'Password must be at least 6 characters'; return }
      if(password !== password2){ rmsg.textContent = 'Passwords do not match'; return }

      const users = getUsers() || [];
      if(users.find(x => x.username.toLowerCase() === username.toLowerCase())){ rmsg.textContent = 'User already exists'; return }

      const hh = await hashPassword(password);
      const id = users.length ? Math.max(...users.map(x => x.id)) + 1 : 1;
      users.push({ id, username, password: hh, rank: 'Trial Moderator', created: new Date().toISOString() });
      saveUsers(users);
      setSession({ id, username, rank: 'Trial Moderator' });
      rmsg.textContent = 'Registered';
      renderAdmin();
      setTimeout(closeModal, 700);
    });
  });

  /* Open admin area button */
  btnOpenAdmin.addEventListener('click', () => renderAdmin());

  /* Render admin area (only allowed roles) */
  function renderAdmin(){
    const s = getSession();
    if(!s){ alert('Please sign in'); return }
    const allowed = ['Owner','Developer','Manager','Community Manager','Head of Staff','Staff Supervisor','Administrator'];
    if(!allowed.includes(s.rank)){ alert('You do not have permission'); return }

    const users = getUsers() || [];
    let html = `<div class="small">Signed in: <strong>${escapeHtml(s.username)}</strong> (${escapeHtml(s.rank)}) <button id="logout" class="link" style="margin-left:12px">Sign out</button></div>`;

    users.forEach(u => {
      html += `<div class="user-row"><div class="meta"><strong>${escapeHtml(u.username)}</strong><div class="small">Rank: ${escapeHtml(u.rank)}</div></div><div><select data-id="${u.id}"></select> <button class="link" data-del="${u.id}">Delete</button></div></div>`;
    });

    html += `<details><summary>Quick add user</summary>
      <form id="quickAdd" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <input name="username" placeholder="Username" />
        <input name="password" placeholder="Password" />
        <select name="rank"></select>
        <button class="btn" type="submit">Add</button>
      </form>
    </details>`;

    adminArea.style.display = 'block';
    adminArea.innerHTML = html;

    /* Logout */
    const logoutBtn = adminArea.querySelector('#logout');
    logoutBtn && logoutBtn.addEventListener('click', function(){
      sessionStorage.removeItem(SESSION_KEY);
      adminArea.style.display = 'none';
      alert('Signed out');
    });

    /* Delete buttons */
    adminArea.querySelectorAll('[data-del]').forEach(b => {
      b.addEventListener('click', function(){
        const id = Number(this.dataset.del);
        if(!confirm('Delete this user?')) return;
        const users = getUsers() || [];
        const idx = users.findIndex(x => x.id === id);
        if(idx > -1){
          users.splice(idx,1);
          saveUsers(users);
          renderAdmin();
        }
      });
    });

    /* Populate selects for ranks */
    adminArea.querySelectorAll('select[data-id]').forEach(sel => {
      roles.forEach(r => {
        const opt = document.createElement('option'); opt.value = r; opt.textContent = r;
        sel.appendChild(opt);
      });
      const id = Number(sel.dataset.id);
      const u = users.find(x => x.id === id);
      if(u) sel.value = u.rank;
      sel.addEventListener('change', function(){
        const newRank = this.value;
        const users = getUsers() || [];
        const idx = users.findIndex(x => x.id == this.dataset.id);
        if(idx > -1){
          users[idx].rank = newRank;
          saveUsers(users);
          alert('Rank changed');
          renderAdmin();
        }
      });
    });

    /* Populate quickAdd rank select */
    const rankSel = adminArea.querySelector('select[name=rank]');
    roles.forEach(r => {
      const o = document.createElement('option'); o.value = r; o.textContent = r; rankSel.appendChild(o);
    });

    /* Quick add */
    const quickAdd = adminArea.querySelector('#quickAdd');
    quickAdd.addEventListener('submit', async function(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      const username = (fd.get('username') || '').trim();
      const password = fd.get('password') || '';
      const rank = fd.get('rank') || 'Trial Moderator';
      if(!username || !password){ alert('Please fill in username and password'); return }
      const users = getUsers() || [];
      if(users.find(x => x.username.toLowerCase() === username.toLowerCase())){ alert('User already exists'); return }
      const hh = await hashPassword(password);
      const id = users.length ? Math.max(...users.map(x => x.id)) + 1 : 1;
      users.push({ id, username, password: hh, rank, created: new Date().toISOString() });
      saveUsers(users);
      alert('Added');
      renderAdmin();
    });
  }

  /* Escape helper to avoid injection in innerHTML */
  function escapeHtml(str){
    if(!str) return '';
    return String(str).replace(/[&<>"']/g, function(m){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
    });
  }

  /* Theme toggle + auto-year */
  document.querySelectorAll('[data-year]').forEach(el => el.textContent = new Date().getFullYear());
  const themeBtn = document.getElementById('themeToggle');
  const body = document.body;
  if(localStorage.getItem('theme') === 'dark'){ body.classList.add('dark'); themeBtn.textContent = '‚òÄÔ∏è Light' }

  themeBtn.addEventListener('click', () => {
    body.classList.toggle('dark');
    if(body.classList.contains('dark')){ localStorage.setItem('theme','dark'); themeBtn.textContent = '‚òÄÔ∏è Light' }
    else { localStorage.setItem('theme','light'); themeBtn.textContent = 'üåô Dark' }
  });

})();
</script>
</body>
</html>
